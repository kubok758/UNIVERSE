<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIVERSE: DARK SIGNAL</title>
    <style>
        body {
            margin: 0;
            background-color: #000000;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: hidden;
            transition: filter 0.2s;
        }

        /* --- HUD --- */
        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 280px; /* Чуть уже для аккуратности */
            z-index: 1000;
            pointer-events: none;
        }

        .hud-main {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00d2ff;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.15);
            pointer-events: auto;
        }

        h1 { margin: 0 0 10px; font-size: 1.2rem; color: #00d2ff; letter-spacing: 2px; text-transform: uppercase; }
        
        .hud-row { 
            display: flex; justify-content: space-between; 
            font-size: 0.8rem; color: #ccc; margin-bottom: 4px; 
        }

        /* Поле ввода SEED */
        .seed-container {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .seed-input {
            background: rgba(0, 20, 40, 0.5);
            border: 1px solid #333;
            border-bottom: 1px solid #00d2ff;
            color: #fff;
            padding: 5px;
            font-family: inherit;
            text-align: center;
            outline: none;
        }

        /* КНОПКА ПРИМЕНИТЬ */
        .btn-apply {
            background: rgba(0, 210, 255, 0.1);
            border: 1px solid #00d2ff;
            color: #00d2ff;
            padding: 8px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .btn-apply:hover {
            background: #00d2ff;
            color: black;
            box-shadow: 0 0 15px #00d2ff;
        }

        .btn-apply:active {
            transform: scale(0.98);
        }

        /* Лог событий */
        .log-panel {
            background: rgba(0, 10, 20, 0.9);
            border-left: 2px solid #ff3333;
            height: 120px;
            overflow: hidden;
            padding: 10px;
            font-size: 0.7rem;
            display: flex;
            flex-direction: column-reverse; /* Новые снизу, но мы вставляем сверху */
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }

        .log-entry { margin-bottom: 4px; opacity: 0.8; text-shadow: 0 0 2px black; }
        .log-warn { color: #ffaa00; }
        .log-danger { color: #ff3333; font-weight: bold; }
        .log-sys { color: #00d2ff; }
        .log-ghost { color: #555; font-style: italic; }

        /* --- ОБЪЕКТЫ --- */
        .universe-container { width: 100%; position: relative; min-height: 100vh; }
        .sector { position: relative; width: 100%; height: 80vh; overflow: hidden; }
        
        .star { position: absolute; background: white; border-radius: 50%; z-index: 1; }
        
        /* Планеты */
        .planet {
            position: absolute; border-radius: 50%;
            box-shadow: inset -10px -10px 30px rgba(0,0,0,0.9), 0 0 10px rgba(255,255,255,0.2);
            cursor: pointer; z-index: 10; transition: transform 0.3s;
        }
        .planet:hover { transform: scale(1.1); border: 1px solid #00d2ff; }

        /* АНОМАЛИИ */
        .anomaly-blackhole {
            position: absolute; border-radius: 50%;
            background: black;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 30px 5px rgba(255, 255, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.5);
            z-index: 20; cursor: pointer;
            animation: pulse-bh 2s infinite alternate;
        }

        .anomaly-rift {
            position: absolute; width: 4px; height: 120px;
            background: #9900ff;
            box-shadow: 0 0 15px 4px #9900ff;
            transform: rotate(45deg);
            z-index: 15; cursor: pointer;
        }

        @keyframes pulse-bh { 0% { box-shadow: 0 0 20px white; } 100% { box-shadow: 0 0 50px white; } }

        /* Глитч эффекты */
        .reality-collapse {
            animation: glitch-anim 0.2s infinite;
            filter: contrast(200%) hue-rotate(90deg) blur(2px);
        }
        @keyframes glitch-anim {
            0% { transform: translate(0); }
            20% { transform: translate(-5px, 5px); }
            40% { transform: translate(5px, -5px); }
            100% { transform: translate(0); }
        }

        /* Экран смерти */
        .signal-lost {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 9999;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 2s;
        }
        .signal-lost.active { opacity: 1; pointer-events: auto; }
        .signal-lost h1 { color: red; font-size: 3rem; text-shadow: 2px 2px white; font-family: sans-serif; }

        .trigger { height: 10px; width: 100%; }
    </style>
</head>
<body>

    <div class="hud">
        <div class="hud-main">
            <h1>UNIVERSE OS</h1>
            <div class="hud-row"><span>SECTOR:</span> <span id="sectorVal">000</span></div>
            <div class="hud-row"><span>DEPTH:</span> <span id="distVal">0 LY</span></div>
            
            <div class="seed-container">
                <input type="number" id="seedInput" class="seed-input" value="666" placeholder="SEED CODE">
                <button class="btn-apply" onclick="applySeed()">REBOOT SYSTEM</button>
            </div>
        </div>
        
        <div class="log-panel" id="logPanel">
            <div class="log-entry log-sys">> SYSTEM ONLINE</div>
            <div class="log-entry log-sys">> WAITING FOR INPUT...</div>
        </div>
    </div>

    <div class="universe-container" id="universe"></div>
    <div class="trigger" id="trigger"></div>

    <div class="signal-lost" id="deathScreen">
        <h1>SIGNAL LOST</h1>
        <p style="color: #666;">CRITICAL REALITY FAILURE</p>
    </div>

    <script>
        // --- SEED SYSTEM ---
        let seed = 666;
        
        // Функция "псевдо-случайности"
        function random() {
            seed = (seed * 9301 + 49297) % 233280;
            return seed / 233280;
        }
        function randRange(min, max) { return min + random() * (max - min); }

        // --- DOM Elements ---
        const universe = document.getElementById('universe');
        const logPanel = document.getElementById('logPanel');
        const deathScreen = document.getElementById('deathScreen');
        
        let totalDistance = 0;
        let sectorCount = 0;

        // --- ЛОГГЕР ---
        function addLog(msg, type = 'log-sys') {
            const el = document.createElement('div');
            el.className = `log-entry ${type}`;
            el.innerText = `> ${msg}`;
            logPanel.prepend(el);
            if (logPanel.children.length > 8) logPanel.lastElementChild.remove();
        }

        // --- ГЛАВНАЯ ФУНКЦИЯ: СМЕНА МИРА ---
        function applySeed() {
            // 1. Берем значение из инпута
            const inputVal = document.getElementById('seedInput').value;
            seed = parseInt(inputVal) || Math.floor(Math.random() * 10000); // Если пусто - случайный
            
            // 2. Очищаем экран
            universe.innerHTML = ''; 
            
            // 3. Сбрасываем счетчики
            totalDistance = 0;
            sectorCount = 0;
            document.getElementById('distVal').innerText = "0 LY";
            document.getElementById('sectorVal').innerText = "000";

            // 4. Пишем в лог
            logPanel.innerHTML = ''; // Чистим старый лог
            addLog(`SYSTEM REBOOTED. SEED: ${seed}`, 'log-danger');
            addLog("GENERATING NEW TIMELINE...", 'log-sys');

            // 5. Запускаем генерацию (триггер сработает сам, но добавим старт)
            createSector();
            createSector();
            
            // Скроллим наверх
            window.scrollTo(0, 0);
        }

        // --- СОЗДАНИЕ СЕКТОРА ---
        function randomColor() { return `hsl(${randRange(0,360)}, 70%, 50%)`; }

        function createSector() {
            sectorCount++;
            const sector = document.createElement('div');
            sector.classList.add('sector');
            const frag = document.createDocumentFragment();

            // Звезды
            for(let i=0; i<35; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const s = randRange(1, 3);
                star.style.width = s+'px'; star.style.height = s+'px';
                star.style.left = randRange(0,100)+'%'; star.style.top = randRange(0,100)+'%';
                star.style.opacity = randRange(0.2, 1);
                frag.appendChild(star);
            }

            // Планеты
            if (random() > 0.65) {
                const p = document.createElement('div');
                p.className = 'planet';
                const s = randRange(60, 140);
                p.style.width = s+'px'; p.style.height = s+'px';
                p.style.left = randRange(10,80)+'%'; p.style.top = randRange(10,80)+'%';
                p.style.background = randomColor();
                p.onclick = () => {
                    addLog(`DATA: Planet ID-${Math.floor(random()*1000)} analyzed.`, 'log-sys');
                    p.style.border = "2px solid #00d2ff";
                };
                frag.appendChild(p);
            }

            // Аномалии
            const roll = random();
            if (roll > 0.98) { // Черная дыра
                const bh = document.createElement('div');
                bh.className = 'anomaly-blackhole';
                const s = randRange(100, 180);
                bh.style.width = s+'px'; bh.style.height = s+'px';
                bh.style.left = randRange(20,60)+'%'; bh.style.top = randRange(20,60)+'%';
                bh.onclick = triggerGameOver;
                frag.appendChild(bh);
                addLog("WARNING: GRAVITATIONAL SINGULARITY NEARBY", "log-danger");
            } else if (roll > 0.96) { // Разлом
                const rift = document.createElement('div');
                rift.className = 'anomaly-rift';
                rift.style.left = randRange(10,90)+'%'; rift.style.top = randRange(10,90)+'%';
                frag.appendChild(rift);
            }

            // Призрачные сообщения (редко)
            if (roll < 0.02) {
                setTimeout(() => addLog("...is someone there?", "log-ghost"), 1000);
            }

            sector.appendChild(frag);
            universe.appendChild(sector);
            
            totalDistance += Math.floor(randRange(300, 800));
            document.getElementById('distVal').innerText = totalDistance.toLocaleString() + ' LY';
            document.getElementById('sectorVal').innerText = sectorCount;
        }

        function triggerGameOver() {
            document.body.classList.add('reality-collapse');
            document.querySelector('.hud').style.display = 'none';
            setTimeout(() => deathScreen.classList.add('active'), 1500);
            setTimeout(() => location.reload(), 5000);
        }

        // --- SCROLL OBSERVER ---
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Если видно дно - генерируем еще
                    for(let i=0; i<3; i++) createSector();
                }
            });
        }, { rootMargin: '400px' });

        // Старт
        applySeed(); // Используем функцию для начальной генерации
        observer.observe(document.getElementById('trigger'));

    </script>
</body>
</html>

