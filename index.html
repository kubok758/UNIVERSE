<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIVERSE: DARK NIGHT</title>
    <style>
        /* --- БАЗА --- */
        body {
            margin: 0; background-color: #000; color: white;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            transition: background 0.1s;
        }

        /* --- UI --- */
        .top-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 50px;
            background: rgba(0,0,0,0.9); border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; z-index: 1000; box-sizing: border-box;
        }
        .status-text { font-size: 0.9rem; color: #00d2ff; font-weight: bold; }
        .btn-menu { background: transparent; border: 1px solid #00d2ff; color: #00d2ff; padding: 5px 10px; font-weight: bold; cursor: pointer; }

        .side-menu {
            position: fixed; top: 50px; left: 0; width: 100%; background: rgba(5,0,0,0.95);
            border-bottom: 2px solid #555; padding: 20px; box-sizing: border-box;
            transform: translateY(-150%); transition: transform 0.3s; z-index: 999;
        }
        .side-menu.active { transform: translateY(0); }
        
        .menu-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .seed-input { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 10px; text-align: center; font-size: 1.1rem; }
        .btn-action { background: #002233; border: 1px solid #00d2ff; color: #00d2ff; padding: 10px 20px; font-weight: bold; cursor: pointer; }
        .btn-danger { background: #330000; border: 1px solid red; color: red; width: 100%; padding: 10px; margin-top: 5px; cursor: pointer; }

        .log-panel { height: 120px; overflow: hidden; background: black; border: 1px solid #333; padding: 5px; font-size: 11px; display: flex; flex-direction: column-reverse; }
        .log-entry { margin-bottom: 3px; border-bottom: 1px solid #111; }
        .c-red { color: #f33; } .c-blue { color: #0df; } 
        .c-cursed { color: red; font-weight: 900; font-size: 1.2em; text-transform: uppercase; letter-spacing: 2px; }

        /* --- КОСМОС --- */
        .universe-container { width: 100%; min-height: 100vh; }
        .sector { position: relative; width: 100%; height: 70vh; overflow: hidden; }
        .star { position: absolute; background: white; border-radius: 50%; }
        .planet { 
            position: absolute; border-radius: 50%; cursor: pointer; z-index: 10; 
            box-shadow: inset -5px -5px 20px rgba(0,0,0,0.8); transition: transform 0.2s; 
        }

        /* --- MODALS --- */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1500; display: none; }
        .overlay.active { display: block; }

        .planet-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 85%; max-width: 320px; background: #0a0a0a; border: 1px solid #00d2ff; padding: 20px; z-index: 2000;
            text-align: center; transition: 0.2s; opacity: 0; pointer-events: none;
            box-shadow: 0 0 50px rgba(0, 210, 255, 0.2);
        }
        .planet-modal.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }
        .planet-visual { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 15px; border: 3px solid #222; }

        .btn-collection { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: #000; border: 2px solid #00d2ff; color: #00d2ff; font-size: 24px; display: flex; justify-content: center; align-items: center; z-index: 1000; box-shadow: 0 0 20px rgba(0, 210, 255, 0.3); }
        .collection-panel {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 70vh;
            background: rgba(10,10,10,0.98); border-top: 3px solid #00d2ff; z-index: 2001;
            transform: translateY(110%); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); padding: 20px; overflow-y: auto; box-sizing: border-box;
        }
        .collection-panel.active { transform: translateY(0); }
        .col-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; }
        .col-item { border: 1px solid #333; padding: 10px; text-align: center; font-size: 10px; background: #000; }

        /* ========================================= */
        /* === HORROR ASSETS === */
        /* ========================================= */
        
        /* Лицо (SVG) */
        .scare-face {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9000; opacity: 0;
            display: flex; justify-content: center; align-items: center;
            background: black;
        }
        .scare-face svg { width: 90%; height: 90%; fill: #800; filter: drop-shadow(0 0 20px red); }
        
        @keyframes strobe {
            0% { opacity: 1; background: black; }
            25% { opacity: 1; background: white; }
            50% { opacity: 1; background: red; }
            75% { opacity: 0; background: black; }
            100% { opacity: 1; background: white; }
        }

        .violent-shake { animation: v-shake 0.1s infinite; }
        @keyframes v-shake {
            0% { transform: translate(10px, 10px) rotate(5deg); }
            25% { transform: translate(-10px, -10px) rotate(-5deg); }
            50% { transform: translate(10px, -10px) rotate(5deg); }
            75% { transform: translate(-10px, 10px) rotate(-5deg); }
        }

        /* Проклятый режим */
        body.cursed .top-bar { border-bottom: 2px solid red; background: #200; }
        body.cursed .status-text { color: red !important; }
        body.cursed .btn-menu { border-color: red; color: red; }
        body.cursed .star { background: #500 !important; }
        body.cursed .planet-modal { border-color: red; background: #100; }
        body.cursed .btn-collection { border-color: red; color: red; box-shadow: 0 0 20px red; }

        .glitch-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 5rem; font-weight: bold; color: red; opacity: 0; z-index: 8000;
            text-shadow: 5px 0 0 black; font-family: sans-serif; pointer-events: none;
            white-space: nowrap;
        }

        .trigger { height: 10px; }

    </style>
</head>
<body>

    <audio id="screamSound" src="jumpscare.mp3" preload="auto"></audio>

    <div class="scare-face" id="scareFace">
        <svg viewBox="0 0 100 120">
            <path d="M10,20 Q50,-20 90,20 Q100,60 90,100 Q50,130 10,100 Q0,60 10,20 Z" fill="#100" />
            <circle cx="30" cy="40" r="10" fill="white" />
            <circle cx="30" cy="40" r="2" fill="black" />
            <circle cx="70" cy="40" r="10" fill="white" />
            <circle cx="70" cy="40" r="2" fill="black" />
            <path d="M30,80 Q50,120 70,80 Q70,50 50,50 Q30,50 30,80" fill="black" stroke="red" stroke-width="2"/>
        </svg>
    </div>

    <div class="glitch-overlay" id="glitchText">DIE</div>

    <div class="top-bar">
        <div class="status-text" id="statusLabel">DEPTH: <span id="distVal">0</span> LY</div>
        <button class="btn-menu" id="menuBtn" onclick="toggleMenu()">SYSTEM ▼</button>
    </div>

    <div class="side-menu" id="sideMenu">
        <div class="menu-row">
            <input type="number" id="seedInput" class="seed-input" placeholder="SEED">
        </div>
        <div class="menu-row">
            <button class="btn-action" style="width: 100%;" onclick="applySeed()">REBOOT SYSTEM</button>
        </div>
        <div class="log-panel" id="logPanel"></div>
        <button class="btn-danger" onclick="clearData()">[WIPE SAVED DATA]</button>
    </div>

    <div class="overlay" id="overlay" onclick="closeAll()"></div>

    <div class="planet-modal" id="planetModal">
        <div class="planet-visual" id="modalVisual"></div>
        <h2 id="modalName" style="color:#fff; margin:0 0 5px;">PLANET</h2>
        <p id="modalType" style="color:#aaa; font-size:0.8rem;"></p>
        <div style="text-align: left; font-size: 0.8rem; color: #ddd; margin: 15px 0;">
            Gravity: <span id="modalGrav">1.0 G</span><br>
            Temp: <span id="modalTemp">20 C</span>
        </div>
        <button class="btn-action" id="saveBtn" style="width: 100%;" onclick="saveToCollection()">SAVE TO DATABASE</button>
    </div>

    <button class="btn-collection" id="colBtn" onclick="toggleCollection()">★</button>
    
    <div class="collection-panel" id="colPanel">
        <h3 style="color: #fff; margin-top:0;">DATABASE (<span id="colCount">0</span>)</h3>
        <div class="col-grid" id="colGrid"></div>
        <button class="btn-action" style="margin-top:20px; width:100%;" onclick="toggleCollection()">CLOSE</button>
    </div>

    <div class="universe-container" id="universe"></div>
    <div class="trigger" id="trigger"></div>

    <script>
        let seed = 1234;
        let totalDistance = 0;
        let currentPlanetData = null;
        let isCursed = false; 
        let collection = JSON.parse(localStorage.getItem('universe_col')) || [];

        function random() {
            seed = (seed * 9301 + 49297) % 233280;
            return seed / 233280;
        }
        function randRange(min, max) { return min + random() * (max - min); }
        function randChoice(arr) { return arr[Math.floor(random() * arr.length)]; }

        // --- HORROR LOGIC (1 SECOND SCREAM + AUDIO) ---
        
        function triggerHardcoreJumpscare() {
            const scareEl = document.getElementById('scareFace');
            const glitchEl = document.getElementById('glitchText');
            const audio = document.getElementById('screamSound'); // Получаем аудио
            
            // 1. ВИЗУАЛ
            scareEl.style.opacity = 1;
            scareEl.style.animation = "strobe 0.1s infinite"; 
            document.body.classList.add('violent-shake');
            
            const words = ["DON'T LOOK", "IT'S HERE", "666", "DIE", "YOU FOUND ME"];
            glitchEl.innerText = words[Math.floor(Math.random() * words.length)];
            glitchEl.style.opacity = 1;

            // 2. ЗВУК (Пытаемся воспроизвести)
            if(audio) {
                audio.currentTime = 0; // На начало
                audio.play().catch(e => console.log("Audio blocked:", e));
            }

            if(navigator.vibrate) navigator.vibrate([1000]); // Вибрация 1 секунду

            // 3. ТАЙМЕР НА 1 СЕКУНДУ (1000 мс)
            setTimeout(() => {
                scareEl.style.opacity = 0;
                scareEl.style.animation = "none";
                document.body.classList.remove('violent-shake');
                glitchEl.style.opacity = 0;
                
                // Останавливаем звук, если он длиннее 1 сек (опционально)
                if(audio) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            }, 1000); 
        }

        function generateCursedText() {
            const chars = "X0@#%&?!";
            let str = "";
            for(let i=0; i<15; i++) str += chars.charAt(Math.floor(Math.random() * chars.length));
            return str;
        }

        // --- UI ---
        const logPanel = document.getElementById('logPanel');
        
        function addLog(msg, type='c-blue') {
            const div = document.createElement('div');
            div.className = `log-entry ${type}`;
            div.innerText = `> ${msg}`;
            logPanel.prepend(div);
            if(logPanel.children.length > 20) logPanel.lastElementChild.remove();
        }

        function toggleMenu() {
            if (isCursed && Math.random() > 0.7) {
                document.getElementById('menuBtn').style.transform = `translateX(${Math.random()*50-25}px)`;
                return; 
            }
            const sm = document.getElementById('sideMenu');
            sm.classList.toggle('active');
            if(sm.classList.contains('active')) document.getElementById('colPanel').classList.remove('active');
        }

        function toggleCollection() {
            const cp = document.getElementById('colPanel');
            cp.classList.toggle('active');
            updateCollectionUI();
            document.getElementById('sideMenu').classList.remove('active');
            closeAll();
        }

        function closeAll() {
            document.getElementById('planetModal').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function clearData() {
            if(confirm("DELETE ALL DATA?")) {
                localStorage.removeItem('universe_col');
                collection = [];
                updateCollectionUI();
                addLog("MEMORY WIPED", "c-red");
                toggleMenu();
            }
        }

        // --- SAVE ---
        function saveToCollection() {
            if(isCursed) {
                triggerHardcoreJumpscare();
                addLog("SAVE FAILED: " + generateCursedText(), "c-cursed");
                return;
            }
            if (!currentPlanetData) return;
            if(collection.find(p => p.name === currentPlanetData.name)) return;
            collection.push(currentPlanetData);
            localStorage.setItem('universe_col', JSON.stringify(collection));
            addLog("DATA SAVED: " + currentPlanetData.name, "c-blue");
            updateCollectionUI();
            closeAll();
        }

        function updateCollectionUI() {
            document.getElementById('colCount').innerText = collection.length;
            const grid = document.getElementById('colGrid');
            grid.innerHTML = '';
            collection.forEach(p => {
                const item = document.createElement('div');
                item.className = 'col-item';
                item.innerHTML = `<div style="width:40px;height:40px;border-radius:50%;background:${p.color};margin:0 auto 5px;"></div><div style="color:#aaa;">${p.name}</div>`;
                grid.appendChild(item);
            });
        }

        // --- GEN ---
        function generatePlanetData(color) {
            if (isCursed) {
                return { name: generateCursedText(), type: "UNKNOWN ENTITY", gravity: "???", temp: "666", color: "#300" };
            }
            const names = ['Kepler', 'Gliese', 'Atlas', 'Nova', 'Centauri', 'Terra'];
            const types = ['Gas Giant', 'Ice World', 'Desert', 'Oceanic', 'Terran'];
            return {
                name: `${randChoice(names)}-${Math.floor(random()*999)}`,
                type: randChoice(types),
                gravity: randRange(0.5, 3.0).toFixed(2),
                temp: Math.floor(randRange(-100, 400)),
                color: color
            };
        }

        function openPlanet(data) {
            currentPlanetData = data;
            document.getElementById('modalName').innerText = data.name;
            document.getElementById('modalType').innerText = data.type;
            document.getElementById('modalGrav').innerText = data.gravity;
            document.getElementById('modalTemp').innerText = data.temp;
            document.getElementById('modalVisual').style.background = data.color;
            document.getElementById('overlay').classList.add('active');
            document.getElementById('planetModal').classList.add('active');
        }

        function createSector() {
            const sector = document.createElement('div');
            sector.classList.add('sector');
            const frag = document.createDocumentFragment();

            if (isCursed && Math.random() > 0.90) triggerHardcoreJumpscare();

            const starCount = isCursed ? 5 : 30;
            for(let i=0; i<starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const s = randRange(1, 3);
                star.style.width = s+'px'; star.style.height = s+'px';
                star.style.left = randRange(0,100)+'%'; star.style.top = randRange(0,100)+'%';
                star.style.opacity = isCursed ? Math.random() : randRange(0.3, 1);
                if(isCursed) star.style.background = (Math.random()>0.5)?'red':'#300';
                frag.appendChild(star);
            }

            if (random() > (isCursed ? 0.8 : 0.7)) {
                const p = document.createElement('div');
                p.className = 'planet';
                const s = randRange(50, 100);
                const color = isCursed ? '#400' : `hsl(${randRange(0,360)}, 60%, 50%)`;
                p.style.width = s+'px'; p.style.height = s+'px';
                p.style.left = randRange(15,85)+'%'; p.style.top = randRange(10,80)+'%';
                p.style.background = color;
                const pData = generatePlanetData(color);
                p.onclick = (e) => { e.stopPropagation(); openPlanet(pData); };
                frag.appendChild(p);
            }

            sector.appendChild(frag);
            document.getElementById('universe').appendChild(sector);
            
            totalDistance += Math.floor(randRange(100, 300));
            const distText = isCursed ? generateCursedText() : totalDistance.toLocaleString();
            document.getElementById('distVal').innerText = distText;
        }

        function applySeed() {
            const val = document.getElementById('seedInput').value;
            seed = parseInt(val) || Math.floor(Math.random()*9999);
            isCursed = (seed === 758);
            
            document.getElementById('universe').innerHTML = '';
            document.getElementById('logPanel').innerHTML = '';
            totalDistance = 0;
            
            const body = document.body;
            if (isCursed) {
                body.classList.add('cursed');
                document.getElementById('statusLabel').innerHTML = "RUN AWAY";
                addLog("FATAL ERROR: 758", "c-cursed");
                setTimeout(triggerHardcoreJumpscare, 1500);
            } else {
                body.classList.remove('cursed');
                document.body.classList.remove('violent-shake');
                document.getElementById('scareFace').style.opacity = 0;
                document.getElementById('statusLabel').innerHTML = 'DEPTH: <span id="distVal">0</span> LY';
                addLog("SYSTEM REBOOT COMPLETE", "c-blue");
            }
            
            document.getElementById('sideMenu').classList.remove('active');
            createSector(); createSector(); createSector();
            window.scrollTo(0,0);
        }

        const observer = new IntersectionObserver(es => {
            es.forEach(e => { if(e.isIntersecting) for(let i=0;i<3;i++) createSector(); });
        }, {rootMargin:'400px'});
        
        observer.observe(document.getElementById('trigger'));
        document.getElementById('colCount').innerText = collection.length;
        applySeed();
    </script>
</body>
</html>

